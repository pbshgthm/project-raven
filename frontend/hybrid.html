<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="d3.min.js"></script>
  <script src="support.js"></script>
  <script src="data.json"></script>
  <title>Raven Hybrid</title>
	
</head>
<body bgcolor="#ECEFF1">
	<div id="ground" style="position: absolute; top: 15vh; left:2vw;"></div>
</body>
<script type="text/javascript">
  Data.init(raw_data);

  var svg = d3.select("#ground")
              .append("svg")
              .attr("width", 900)
              .attr("height", 600)
              .style('background-color','white')




  function ageViolin(){
        var ageBins=Data.ageDist();
        var curveFunc = d3.line()
                          .x(function(d) {return d[0]})
                          .y(function(d) {return d[1]})
                          .curve(d3.curveCardinal);
                      
        function drawViolin(points){    
            var curve = svg.append("path")
                        .attr("d", curveFunc(points))
                        //.attr("stroke", '#FF7043')
                        //.attr("stroke-width", 4)
                        .attr("fill", "#FFAB91");
        }

        ageBins=[0].concat(ageBins).concat([0])
        agePoints=ageBins.map((x,i)=>[450-x/10,600-(10+27*i)])
        drawViolin(agePoints)
        agePoints=ageBins.map((x,i)=>[450+x/10,600-(10+27*i)])
        drawViolin(agePoints)
  }

  function ageBars(){
                      
      var ageBins=Data.ageDist();

      function drawBars(points){    
            var curve = svg.selectAll("bar")
                        .data(points).enter()
                        .append("rect")
                        .attr("fill", "#FFAB91")
                        .attr("x", function(d,i){return 50+i*40})
                        .attr("width", 35)
                        .attr('rx',2)
                        .attr('ry',2)
                        .attr("y", 400)
                        .attr("height", 0)
                        .transition()
                        .ease(d3.easeLinear)
                        .duration(400)
                        .delay(function (d, i) {return i * 30;})
                        .attr("y", function (d, i) {return 400 - d/7;})
                        .attr("height", function (d, i) {return d/7;});
        }
      
      drawBars(ageBins)
      

  }

  //ageBars();
  //ageViolin();

  function timeLine(){

      var dates=Data.traffickDate();
      var colorise = d3.scaleSequential().domain([-50,170])
                      .interpolator(d3.interpolateInferno);
      function drawBars(points){    
            var curve = svg.selectAll("bar")
                        .data(points).enter()
                        .append("rect")
                        .attr("fill", function(d){return colorise(d)})
                        .attr("x", function(d,i){return i*3.7})
                        .attr("width", 1)
                        .attr('rx',2)
                        .attr('ry',2)
                        .attr("y", 300)
                        .attr("height", 0)
                        .transition()
                        .ease(d3.easeLinear)
                        .duration(400)
                        .delay(function (d, i) {return i * 30;})
                        .attr("y", function (d, i) {return 300 - d;})
                        .attr("height", function (d, i) {return d*2;});
        }
      
      //drawBars(dates)
  }


  function timeArcs(){
    var dates=Data.traffickDate();

    var curveFunc = d3.line()
                      .x(function(d) {return d[0]})
                      .y(function(d) {return d[1]})
                      .curve(d3.curveBasis);

    var colorise = d3.scaleSequential().domain([0,900])
                      .interpolator(d3.interpolateInferno);

    function drawArc(src,dst,i){  
            var curve = svg.append("path")
                        .attr("d", curveFunc([
                            [50+src,300],
                            [50+(src+dst)/2,300+2*(i-0.5)*(dst-src)/2],
                            [50+dst,300]
                        ]))
                        .attr("stroke", colorise(dst-src))
                        .attr("stroke-width", 2)
                        .attr("opacity",0.1)
                        .attr("fill", "none");
        }
    dates.map((x,i)=>drawArc(x[0]*3.5,x[1]*3.5,i%2))

    var a=Array(228).fill(0).map((d,i)=>i)
    var dots = svg.selectAll('dots')
                  .data(a).enter()
                  .append('circle')
                  .attr('cx',function(d){return 50+3.5*d})
                  .attr('cy',300)
                  .attr('r',1)
                  .attr('fill','#CFD8DC')
                  
  }
  timeArcs();
  //timeLine();

</script>
</html>